{% extends "base.html" %} {% block title %}Cart - ETERNO{% endblock %}
{% block content %}
  <div class="cart-container">
    <h1 class="cart-header">YOUR CART</h1>
  
    <div class="cart-content">
      {% if cart_items %}
      <div class="cart-items">
        {% for cart_item, product in cart_items %}
        <div class="cart-item">
          <div class="item-image">
            {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}" />
            {% else %}
            <div class="item-placeholder">E</div>
            {% endif %}
          </div>
  
          <div class="item-details">
            <h3 class="item-name">{{ product.name }}</h3>
            <div class="item-price">‚Ç±{{ "%.2f"|format(product.price) }} each</div>
            <div class="item-controls">
              <div class="qty-control">
                <button
                  class="qty-btn"
                  onclick="updateQuantity('{{ cart_item.id }}', -1)"
                >
                  ‚àí
                </button>
                <span class="qty-display">{{ cart_item.quantity }}</span>
                <button
                  class="qty-btn"
                  onclick="updateQuantity('{{ cart_item.id }}', 1)"
                >
                  +
                </button>
              </div>
            </div>
          </div>
  
          <div class="item-actions">
            <div class="item-total">
              ‚Ç±{{ "%.2f"|format(product.price * cart_item.quantity) }}
            </div>
            <button class="remove-btn" onclick="removeItem('{{ cart_item.id }}')">
              Remove
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
  
      <div class="cart-summary">
        <h2 class="summary-title">SUMMARY</h2>
  
        <div class="summary-row">
          <span>Subtotal:</span>
          <span>‚Ç±{{ "%.2f"|format(total_subtotal) }}</span>
        </div>
  
        <div class="summary-row" id="voucherDiscountRow" style="display: none;">
          <span>Voucher Discount:</span>
          <span class="voucher-discount-amount">-‚Ç±100.00</span>
        </div>

        <div class="summary-row">
          <span>Delivery Fee:</span>
          <span id="deliveryFeeDisplay">(Calculated at checkout)</span>
        </div>

        <div class="summary-row">
          <span>TOTAL:</span>
          <span class="summary-total" id="totalDisplay">‚Ç±{{ "%.2f"|format(total_subtotal) }}</span>
        </div>
  
        <div class="payment-section">
          <div class="payment-title">VOUCHER (OPTIONAL)</div>
          <div class="voucher-input-group">
            <input
              type="text"
              id="voucherCode"
              placeholder="Enter voucher code"
              class="voucher-input"
            />
            <button
              class="btn voucher-apply-btn"
              onclick="applyVoucher()"
            >
              Apply
            </button>
          </div>
          <div id="voucherApplied" class="voucher-applied">
            Voucher applied: -‚Ç±100
            <button onclick="removeVoucher()" class="voucher-remove-btn">Remove</button>
          </div>
        </div>

        <div class="payment-section">
          <div class="payment-title">PAYMENT METHOD</div>
          <div class="payment-options">
            <div class="payment-option">
              <input
                type="radio"
                id="credit-card"
                name="payment"
                value="credit_card"
                onchange="showPaymentDetails()"
              />
              <label for="credit-card">Credit / Debit Card</label>
              <span class="payment-icon">üí≥</span>
            </div>

            <div class="payment-option">
              <input type="radio" id="paypal" name="payment" value="paypal" onchange="showPaymentDetails()" />
              <label for="paypal">PayPal</label>
              <span class="payment-icon">üÖøÔ∏è</span>
            </div>

            <div class="payment-option">
              <input type="radio" id="gcash" name="payment" value="gcash" onchange="showPaymentDetails()" />
              <label for="gcash">GCash</label>
              <span class="payment-icon">üí∞</span>
            </div>

            <div class="payment-option">
              <input type="radio" id="cod" name="payment" value="cod" checked onchange="showPaymentDetails()" />
              <label for="cod">Cash on Delivery</label>
              <span class="payment-icon">üíµ</span>
            </div>
          </div>
          
          <div id="paymentDetails" class="payment-details">
            <div id="codDetails" class="payment-detail-section">
              <label>Delivery Address *</label>
              <textarea
                id="codAddress"
                rows="3"
                placeholder="Enter your complete delivery address"
                required
              ></textarea>
            </div>
            
            <div id="gcashDetails" class="payment-detail-section">
              <label>GCash Number *</label>
              <input
                type="tel"
                id="gcashNumber"
                placeholder="09XX XXX XXXX"
                required
              />
              <label>Account Name *</label>
              <input
                type="text"
                id="gcashAccountName"
                placeholder="Enter account holder name"
                required
              />
            </div>
            
            <div id="cardDetails" class="payment-detail-section">
              <label>Card Type *</label>
              <div class="card-type-options">
                <div class="card-type-option payment-option">
                  <input type="radio" id="cardTypeCredit" name="cardType" value="credit" checked />
                  <label for="cardTypeCredit">Credit</label>
                </div>
                <div class="card-type-option payment-option">
                  <input type="radio" id="cardTypeDebit" name="cardType" value="debit" />
                  <label for="cardTypeDebit">Debit</label>
                </div>
              </div>
              <label>Card Number *</label>
              <input
                type="text"
                id="cardNumber"
                placeholder="1234 5678 9012 3456"
                maxlength="19"
                required
              />
              <div class="card-fields-row">
                <div>
                  <label>Expiry Date *</label>
                  <input
                    type="text"
                    id="cardExpiry"
                    placeholder="MM/YY"
                    maxlength="5"
                    required
                  />
                </div>
                <div>
                  <label>CVV *</label>
                  <input
                    type="text"
                    id="cardCVV"
                    placeholder="123"
                    maxlength="4"
                    required
                  />
                </div>
              </div>
            </div>
            
            <div id="paypalDetails" class="payment-detail-section">
              <label>PayPal Email *</label>
              <input
                type="email"
                id="paypalEmail"
                placeholder="your.email@example.com"
                required
              />
              <label>PayPal Account Name *</label>
              <input
                type="text"
                id="paypalName"
                placeholder="Account holder name"
                required
              />
            </div>
          </div>
        </div>

        <button class="checkout-btn" data-total="{{ "%.2f"|format(total_subtotal) }}" onclick="checkoutBtnHandler(this)">
          Proceed to Checkout
        </button>
      </div>
  
      {% else %}
      <div class="empty-cart-message">
        <h2>YOUR CART IS EMPTY</h2>
        <p style="color: var(--text-gray); letter-spacing: 2px">
          Explore our collection and discover the eternal
        </p>
        <a href="{{ url_for('customer.shop') }}" class="btn">SHOP NOW</a>
      </div>
      {% endif %}
    </div>
  </div>
  {% endblock %} {% block extra_js %}
  <script>
    // Initialize baseSubtotal from the page
    document.addEventListener("DOMContentLoaded", function() {
      const totalDisplay = document.getElementById("totalDisplay");
      if (totalDisplay) {
        const totalText = totalDisplay.textContent.replace("‚Ç±", "").replace(",", "");
        window.baseSubtotal = parseFloat(totalText) || 0; // Make global
      }
      // Initialize payment details
      if (document.getElementById("paymentDetails")) {
        showPaymentDetails();
      }
    });
  </script>
  {% endblock %}
  